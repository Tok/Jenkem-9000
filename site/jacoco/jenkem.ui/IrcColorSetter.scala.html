<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>IrcColorSetter.scala</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jenkem</a> &gt; <a href="index.html" class="el_package">jenkem.ui</a> &gt; <span class="el_source">IrcColorSetter.scala</span></div><h1>IrcColorSetter.scala</h1><pre class="source lang-java linenums">/*
 * #%L
 * IrcColorSetter.scala - Jenkem - Tok - 2012
 * %%
 * Copyright (C) 2012 - 2013 Lukas Steiger &lt;lsteiger4@gmail.com&gt;
 * %%
 * This program is free software. It comes without any warranty, to
 * the extent permitted by applicable law. You can redistribute it
 * and/or modify it under the terms of the Do What The Fuck You Want
 * To Public License, Version 2, as published by Sam Hocevar.
 * See http://www.wtfpl.net/ for more details.
 * #L%
 */
package jenkem.ui

import scala.annotation.migration
import scala.collection.immutable.HashMap
import com.vaadin.data.Property
import com.vaadin.data.Property.ValueChangeEvent
import com.vaadin.event.EventRouter
import com.vaadin.shared.ui.slider.SliderOrientation
import com.vaadin.ui.Alignment
import com.vaadin.ui.HorizontalLayout
import com.vaadin.ui.Label
import com.vaadin.ui.NativeSelect
import com.vaadin.ui.Slider
import com.vaadin.ui.VerticalLayout
import jenkem.engine.color.Scheme
import jenkem.event.DoConversionEvent
import jenkem.engine.color.Color

<span class="fc" id="L32">class IrcColorSetter(val eventRouter: EventRouter) extends VerticalLayout {</span>
<span class="fc" id="L33">  var isTriggeringDisabled = false</span>
<span class="fc" id="L34">  setSpacing(true)</span>
<span class="fc" id="L35">  setWidth(&quot;400px&quot;)</span>
<span class="fc" id="L36">  val labels = makeLabelMap</span>
<span class="fc" id="L37">  val sliders = makeSliderMap</span>
<span class="fc" id="L38">  val presetBox = new NativeSelect</span>
<span class="fc" id="L39">  val captionLabel = new Label(&quot;Preset: &quot;)</span>
<span class="fc" id="L40">  captionLabel.setWidth(&quot;150px&quot;)</span>
<span class="pc bpc" id="L41" title="1 of 2 branches missed.">  Scheme.values.foreach(cs =&gt; presetBox.addItem(cs))</span>
<span class="fc" id="L42">  presetBox.setWidth(&quot;250px&quot;)</span>
<span class="fc" id="L43">  presetBox.setNullSelectionAllowed(false)</span>
<span class="fc" id="L44">  presetBox.setImmediate(true)</span>
<span class="pc bpc" id="L45" title="1 of 2 branches missed.">  presetBox.addValueChangeListener(new Property.ValueChangeListener {</span>
<span class="fc" id="L46">    override def valueChange(event: ValueChangeEvent): Unit = {</span>
<span class="pc" id="L47">      Scheme.valueOf(event.getProperty.getValue.toString) match {</span>
<span class="pc bpc" id="L48" title="1 of 2 branches missed.">        case Some(s) =&gt; updatePreset(s)</span>
<span class="nc bnc" id="L49" title="All 6 branches missed.">        case None =&gt; { }</span>
      }
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">      if (!isTriggeringDisabled) {</span>
<span class="fc" id="L52">        eventRouter.fireEvent(new DoConversionEvent(false, false))</span>
      }
    }
  })
<span class="fc" id="L56">  val layout = new HorizontalLayout</span>
<span class="fc" id="L57">  layout.addComponent(captionLabel)</span>
<span class="fc" id="L58">  layout.addComponent(presetBox)</span>
<span class="fc" id="L59">  addComponent(layout)</span>

<span class="fc" id="L61">  val sliderLayout = new HorizontalLayout</span>
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">  Scheme.ircColors.foreach(ic =&gt; sliderLayout.addComponent(makeSliderLayout(ic)))</span>
<span class="fc" id="L63">  addComponent(sliderLayout)</span>

<span class="fc" id="L65">  setSelectedScheme(Scheme.default)</span>
<span class="fc" id="L66">  updatePreset(Scheme.default)</span>

  private def makeLabelMap(): HashMap[Scheme.IrcColor, Label] = {
<span class="fc" id="L69">    def makeLabelMap0(hm: HashMap[Scheme.IrcColor, Label], ic: List[Scheme.IrcColor]): HashMap[Scheme.IrcColor, Label] = {</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">      if (ic.isEmpty) { hm }</span>
      else {
<span class="fc" id="L72">        val label = new Label</span>
<span class="fc" id="L73">        label.setStyleName(&quot;colorLabel &quot; + ic.head.name)</span>
<span class="fc" id="L74">        makeLabelMap0(hm + ((ic.head, label)), ic.tail)</span>
      }
    }
<span class="fc" id="L77">    makeLabelMap0(new HashMap[Scheme.IrcColor, Label], Scheme.ircColors)</span>
  }
  private def makeSliderMap(): HashMap[Scheme.IrcColor, Slider] = {
<span class="fc" id="L80">    def makeSliderMap0(hm: HashMap[Scheme.IrcColor, Slider], ic: List[Scheme.IrcColor]): HashMap[Scheme.IrcColor, Slider] = {</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">      if (ic.isEmpty) { hm }</span>
      else {
<span class="fc" id="L83">        val slider = new Slider</span>
<span class="fc" id="L84">        slider.setHeight(&quot;100px&quot;)</span>
<span class="fc" id="L85">        slider.setResolution(0)</span>
<span class="fc" id="L86">        slider.setOrientation(SliderOrientation.VERTICAL)</span>
<span class="fc" id="L87">        slider.setMin(0)</span>
<span class="fc" id="L88">        slider.setMax(100)</span>
<span class="fc" id="L89">        slider.setImmediate(true)</span>
<span class="fc" id="L90">        slider.setStyleName(&quot;v-slider &quot; + ic.head.name)</span>
<span class="fc" id="L91">        makeSliderMap0(hm + ((ic.head, slider)), ic.tail)</span>
      }
    }
<span class="fc" id="L94">    makeSliderMap0(new HashMap[Scheme.IrcColor, Slider], Scheme.ircColors)</span>
  }
  private def makeSliderLayout(ic: Scheme.IrcColor) = {
<span class="fc" id="L97">    val label = getLabel(ic)</span>
<span class="fc" id="L98">    val slider = getSlider(ic)</span>
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">    slider.addValueChangeListener(new Property.ValueChangeListener {</span>
<span class="fc" id="L100">      override def valueChange(event: ValueChangeEvent) {</span>
<span class="fc" id="L101">        label.setValue(&quot;%1.0f&quot;.format(event.getProperty.getValue))</span>
<span class="pc bpc" id="L102" title="1 of 2 branches missed.">        if (!isTriggeringDisabled) {</span>
<span class="nc" id="L103">          eventRouter.fireEvent(new DoConversionEvent(false, false))</span>
        }
      }
    })
<span class="fc" id="L107">    val layout = new VerticalLayout</span>
<span class="fc" id="L108">    layout.setSpacing(true)</span>
<span class="fc" id="L109">    layout.addComponent(slider)</span>
<span class="fc" id="L110">    layout.setComponentAlignment(slider, Alignment.MIDDLE_CENTER)</span>
<span class="fc" id="L111">    layout.addComponent(label)</span>
<span class="fc" id="L112">    layout</span>
  }
<span class="pc" id="L114">  private def getLabel(ic: Scheme.IrcColor): Label = labels.get(ic) match {</span>
<span class="pc bpc" id="L115" title="1 of 2 branches missed.">    case Some(label) =&gt; label</span>
<span class="nc bnc" id="L116" title="All 6 branches missed.">    case None =&gt; new Label</span>
  }
<span class="pc" id="L118">  private def getSlider(ic: Scheme.IrcColor): Slider = sliders.get(ic) match {</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">    case Some(slider) =&gt; slider</span>
<span class="nc bnc" id="L120" title="All 6 branches missed.">    case None =&gt; new Slider</span>
  }
  private def updatePreset(cs: Scheme): Unit = {
<span class="fc" id="L123">    isTriggeringDisabled = true</span>
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">    Scheme.ircColors.foreach(ic =&gt; getSlider(ic).setValue(ic.scheme(cs.order)))</span>
<span class="fc" id="L125">    isTriggeringDisabled = false</span>
  }
<span class="nc" id="L127">  private def getValue(ic: Scheme.IrcColor) = Integer.valueOf(getLabel(ic).getValue).shortValue</span>

  def getColorMap: Color.IrcMap = {
<span class="nc" id="L130">    def getColorMap0(hm: HashMap[Scheme.IrcColor, Short], ic: List[Scheme.IrcColor]):</span>
        HashMap[Scheme.IrcColor, Short] = {
<span class="nc bnc" id="L132" title="All 2 branches missed.">      if (ic.isEmpty) { hm }</span>
<span class="nc" id="L133">      else { getColorMap0(hm + ((ic.head, getValue(ic.head))), ic.tail) }</span>
    }
<span class="nc" id="L135">    getColorMap0(new HashMap[Scheme.IrcColor, Short], Scheme.ircColors)</span>
  }
<span class="fc" id="L137">  def setSelectedScheme(scheme: Scheme): Unit = presetBox.select(scheme)</span>
  def makeEnabled(enabled: Boolean): Unit = {
<span class="fc" id="L139">    presetBox.setEnabled(enabled)</span>
<span class="fc" id="L140">    sliders.values.foreach(s =&gt; s.setEnabled(enabled))</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.20130617-1803</span></div></body></html>