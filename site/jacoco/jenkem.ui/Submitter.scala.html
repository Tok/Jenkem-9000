<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Submitter.scala</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jenkem</a> &gt; <a href="index.html" class="el_package">jenkem.ui</a> &gt; <span class="el_source">Submitter.scala</span></div><h1>Submitter.scala</h1><pre class="source lang-java linenums">/*
 * #%L
 * Submitter.scala - Jenkem - Tok - 2012
 * %%
 * Copyright (C) 2012 - 2013 Lukas Steiger &lt;lsteiger4@gmail.com&gt;
 * %%
 * This program is free software. It comes without any warranty, to
 * the extent permitted by applicable law. You can redistribute it
 * and/or modify it under the terms of the Do What The Fuck You Want
 * To Public License, Version 2, as published by Sam Hocevar.
 * See http://www.wtfpl.net/ for more details.
 * #L%
 */
package jenkem.ui

import java.awt.image.BufferedImage

import scala.collection.JavaConversions.seqAsJavaList

import com.vaadin.data.Property
import com.vaadin.data.Property.ValueChangeEvent
import com.vaadin.event.EventRouter
import com.vaadin.event.FieldEvents.FocusEvent
import com.vaadin.event.FieldEvents.FocusListener
import com.vaadin.ui.Alignment
import com.vaadin.ui.Button
import com.vaadin.ui.Button.ClickEvent
import com.vaadin.ui.CheckBox
import com.vaadin.ui.GridLayout
import com.vaadin.ui.HorizontalLayout
import com.vaadin.ui.Image
import com.vaadin.ui.Label
import com.vaadin.ui.OptionGroup
import com.vaadin.ui.TextField

import jenkem.event.DoConversionEvent
import jenkem.event.SaveImageEvent
import jenkem.util.AwtImageUtil

<span class="pc" id="L40">class Submitter(val eventRouter: EventRouter) extends HorizontalLayout {</span>
<span class="fc" id="L41">  val maxNameLength = 40</span>
<span class="fc" id="L42">  var disable = false</span>
<span class="pc" id="L43">  var disableTrigger = false</span>

<span class="fc" id="L45">  setSpacing(true)</span>

<span class="fc" id="L47">  val nameTextField = new TextField</span>
<span class="fc" id="L48">  nameTextField.setWidth(250 + &quot;px&quot;)</span>
<span class="fc" id="L49">  nameTextField.setImmediate(true)</span>
<span class="pc bpc" id="L50" title="1 of 2 branches missed.">  nameTextField.addFocusListener(new FocusListener {</span>
<span class="nc" id="L51">    override def focus(event: FocusEvent): Unit = nameTextField.selectAll</span>
  })
<span class="pc bpc" id="L53" title="1 of 2 branches missed.">  nameTextField.addValueChangeListener(new Property.ValueChangeListener {</span>
    override def valueChange(event: ValueChangeEvent): Unit = {
<span class="pc bpc" id="L55" title="1 of 2 branches missed.">      if (!disable) {</span>
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">        if (nameTextField.getValue.size &gt; maxNameLength) {</span>
<span class="nc" id="L57">          disable = true</span>
<span class="nc" id="L58">          nameTextField.setValue(nameTextField.getValue.substring(0, maxNameLength))</span>
        }
      }
<span class="fc" id="L61">      disable = false</span>
    }
  })
<span class="fc" id="L64">  addComponent(nameTextField)</span>
<span class="fc" id="L65">  setComponentAlignment(nameTextField, Alignment.MIDDLE_LEFT)</span>

<span class="fc" id="L67">  val submitButton = new Button(&quot;Submit To Gallery&quot;)</span>
<span class="pc bpc" id="L68" title="1 of 2 branches missed.">  submitButton.addClickListener(new Button.ClickListener {</span>
    override def buttonClick(event: ClickEvent): Unit = {
<span class="nc" id="L70">      eventRouter.fireEvent(new SaveImageEvent)</span>
    }
  })
<span class="fc" id="L73">  addComponent(submitButton)</span>
<span class="fc" id="L74">  setComponentAlignment(submitButton, Alignment.MIDDLE_LEFT)</span>

<span class="fc" id="L76">  val imageLayout = new GridLayout</span>
<span class="fc" id="L77">  imageLayout.setRows(1)</span>
<span class="fc" id="L78">  imageLayout.setColumns(1)</span>
<span class="fc" id="L79">  addComponent(imageLayout)</span>
<span class="fc" id="L80">  setComponentAlignment(imageLayout, Alignment.MIDDLE_LEFT)</span>

<span class="fc" id="L82">  val inversionCaption = new Label(&quot;Invert: &quot;)</span>
<span class="fc" id="L83">  val inversionBox = new CheckBox</span>
<span class="fc" id="L84">  inversionBox.setImmediate(true)</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">  inversionBox.addValueChangeListener(new Property.ValueChangeListener {</span>
    override def valueChange(event: ValueChangeEvent) {
<span class="nc bnc" id="L87" title="All 2 branches missed.">      if (!disableTrigger) {</span>
<span class="nc" id="L88">        eventRouter.fireEvent(new DoConversionEvent(true, true))</span>
      }
    }
  })
<span class="fc" id="L92">  val invLayout = new HorizontalLayout</span>
<span class="fc" id="L93">  invLayout.addComponent(inversionCaption)</span>
<span class="fc" id="L94">  invLayout.addComponent(inversionBox)</span>
<span class="fc" id="L95">  addComponent(invLayout)</span>
<span class="fc" id="L96">  setComponentAlignment(invLayout, Alignment.MIDDLE_LEFT)</span>

<span class="fc" id="L98">  val bgOptions = List(&quot;white&quot;, &quot;black&quot;)</span>
<span class="fc" id="L99">  val bgSelect = new OptionGroup(None.orNull, bgOptions)</span>
<span class="fc" id="L100">  bgSelect.setDescription(&quot;Only relvant for images with transparency.&quot;)</span>
<span class="fc" id="L101">  bgSelect.addStyleName(&quot;horizontal&quot;)</span>
<span class="fc" id="L102">  bgSelect.setNullSelectionAllowed(false)</span>
<span class="fc" id="L103">  bgSelect.setImmediate(true)</span>
<span class="fc" id="L104">  bgSelect.setValue(bgOptions(0))</span>
<span class="pc bpc" id="L105" title="1 of 2 branches missed.">  bgSelect.addValueChangeListener(new Property.ValueChangeListener {</span>
    override def valueChange(event: ValueChangeEvent): Unit = {
<span class="nc bnc" id="L107" title="All 2 branches missed.">      if (!disableTrigger) {</span>
<span class="nc" id="L108">        eventRouter.fireEvent(new DoConversionEvent(true, true))</span>
      }
    }
  })
<span class="fc" id="L112">  addComponent(bgSelect)</span>
<span class="fc" id="L113">  setComponentAlignment(bgSelect, Alignment.MIDDLE_LEFT)</span>

  def addIcon(img: BufferedImage): Unit = {
<span class="fc" id="L116">    val image = new Image</span>
<span class="fc" id="L117">    image.setSource(AwtImageUtil.makeVaadinResource(img, &quot;Icon&quot;))</span>
<span class="fc" id="L118">    image.setWidth(&quot;32px&quot;)</span>
<span class="fc" id="L119">    image.setHeight(&quot;32px&quot;)</span>
<span class="fc" id="L120">    imageLayout.removeAllComponents</span>
<span class="fc" id="L121">    imageLayout.addComponent(image, 0, 0)</span>
  }
<span class="fc" id="L123">  def setName(name: String): Unit = {</span>
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">    val clean = if (name.contains('.')) { name.take(name.lastIndexOf(&quot;.&quot;)) }</span>
<span class="fc" id="L125">    else { name }</span>
<span class="pc bpc" id="L126" title="2 of 4 branches missed.">    if (clean.size &gt; maxNameLength) {</span>
<span class="nc" id="L127">      nameTextField.setValue(clean.substring(0, maxNameLength))</span>
    } else {
<span class="fc" id="L129">      nameTextField.setValue(clean)</span>
    }
  }
  def reset: Unit = {
<span class="fc" id="L133">    disableTrigger = true</span>
<span class="fc" id="L134">    bgSelect.setValue(bgOptions(0))</span>
<span class="fc" id="L135">    inversionBox.setValue(false)</span>
<span class="fc" id="L136">    disableTrigger = false</span>
  }
<span class="fc" id="L138">  def isInvert: Boolean = inversionBox.getValue</span>
<span class="fc" id="L139">  def getBg: String = bgSelect.getValue.toString</span>
<span class="fc" id="L140">  def getName: String = nameTextField.getValue</span>
<span class="fc" id="L141">  def enableSubmission(enabled: Boolean): Unit = submitButton.setEnabled(enabled)</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.20130617-1803</span></div></body></html>